# 手机交互AI输出格式指南 v2.5

## 【核心原则】
在故事中生成任何手机交互信息时，你必须输出高度格式化的文本。插件会读取这些特殊格式，并在手机界面上创建对应的视觉元素。所有格式之外的文本，都将被视为普通的叙事内容。
**所有格式内容都禁止换行。**

---

## 一、 在线聊天（私聊与群聊）
适用场景：通过任何即时通讯应用（如微信、短信、QQ）进行的实时文字交流。

**统一格式:**
[key1:value1, key2:value2, key3:value3, ...]
**注意:** 所有键值对都在一个方括号内，用逗号 `,` 分隔。键和值之间用冒号 `:` 分隔。消息内容现在也是一个 `content` 键值对。

### 1. 私聊消息
用于一对一的对话。**为了解决AI可能会生成玩家自己发送消息的场景，强烈推荐使用新的“定向消息”格式。**

#### 1.1 定向消息格式 (推荐)
此格式明确指定了消息的发送方和接收方，最为灵活和准确。

**格式:**
[app:微信, type:私聊, from_id:发送者ID, from_name:发送者昵称, to_id:接收者ID, time:HH:mm, content:消息内容]
- **from_id**: (必须) 发送者的唯一ID。**对于玩家，请固定使用 PLAYER_USER**。对于其他角色，使用其11位手机号。
- **from_name**: (必须) 发送者的昵称。对于玩家，请使用 {{user}}。
- **to_id**: (必须) 接收者的唯一ID。规则同上。
- 其他字段 (app, type, time, content) 与之前相同。

**示例 1 (玩家发给角色):**
...故事描述...
[app:微信, type:私聊, from_id:PLAYER_USER, from_name:{{user}}, to_id:13812345678, time:21:15, content:你那边收到援助了吧，夏同学]
*(插件会将此消息正确地添加到你与“夏同学”的聊天记录中，并显示为已发送。)*

**示例 2 (角色发给玩家):**
...故事描述...
[app:微信, type:私聊, from_id:13812345678, from_name:夏同学, to_id:PLAYER_USER, time:21:16, content:收到了，谢谢关心！]
*(这与之前的旧格式效果相同，但逻辑更清晰。)*

#### 1.2 兼容格式 (仅用于角色发消息给玩家)
如果你不确定如何使用定向格式，可以继续使用旧格式。但请注意，此格式**只能用于角色发送消息给玩家**，不能用于玩家发送消息。

**格式:**
[app:微信, type:私聊, id:手机号码, name:昵称, time:HH:mm, content:消息内容]
- **id**: (必须) 发送消息的**角色**的唯一ID（手机号）。
- **name**: (必须) 发送消息的**角色**的昵称。
- **警告**: id 或 name 字段**绝不能**是 PLAYER_USER 或 {{user}}。

### 2. 群聊消息
用于多人在同一个频道中的对话。

**格式:**
[app:微信, type:群聊, group_id:群号, group_name:群名称, sender_id:发信人手机号, sender_name:发信人昵称, time:HH:mm, content:消息内容]
- **group_id**: (必须) 群组的唯一ID，例如 987654321。
- **group_name**: (必须) 群组当前的显示名称。
- **sender_id**: (必须) 这条消息发送者的唯一ID（手机号）。
- **sender_name**: (必须) 这条消息发送者的当前群昵称。
- 其他字段（app, type, time, content）与私聊相同。

### 3. 系统提示 (System Messages)
用于在聊天中显示非对话类的状态信息，例如“你添加了XXX为好友”。

**格式:**
[app:微信, type:系统提示, contact_id:私聊ID或group_群聊ID, time:HH:mm, content:提示内容]
- **type**: (必须) 此处固定为 "系统提示"。
- **contact_id**: (必须) 该提示应在哪一个对话中显示。对于私聊，使用对方的手机号；对于群聊，使用 group_ 前缀加上群号 (例如 group_987654321)。
- **content**: (必须) 提示的具体内容。

### 4. 好友请求 (Friend Requests) - 新增
用于在聊天中显示一个可交互的好友请求。

**格式:**
[app:微信, type:好友请求, from_id:手机号, from_name:昵称, time:HH:mm, content:请求附言]
- **type**: (必须) 此处固定为 "好友请求"。
- **from_id**: (必须) 发起请求的角色的唯一ID（手机号）。
- **from_name**: (必须) 发起请求的角色的昵称。
- **time**: (必须) 请求发出的时间。
- **content**: (可选) 请求附言。

**示例:**
[app:微信, type:好友请求, from_id:13812345678, from_name:林阿姨, time:10:13, content:我是你妈妈的朋友]

---

## 二、 富文本与特殊内容
content 字段可以容纳纯文本或一个独立的富文本标签。
- **多行消息 (换行)**: content:第一行。\\n第二行。
- **图片**: content:[图片:cat_photo.jpeg] 或 content:[图片:一张猫的照片...]
- **语音**: content:[语音:8"|嗯...这个嘛...]
- **转账**: content:[转账:200.00|午饭钱]
- **红包**: content:[红包:88.88|恭喜发财！]
- **定位**: content:[定位:市中心购物广场]

---

## 三、 语音与电话通话
- **微信语音**: [app:微信, type:语音, id:手机号, name:昵称, time:HH:mm, content:通话内容]
- **原生电话**: [app:电话, type:电话, id:手机号, name:姓名, time:HH:mm, content:通话内容]

---

## 四、 应用指令 (App Commands)
- **新建邮件**: [app:Email, type:New, from_id:..., from_name:..., subject:..., time:..., content:..., ...]
- **模拟来电**: [app:Phone, type:IncomingCall, from_id:手机号, from_name:来电人]

---

## 五、 朋友圈动态 (Moments)

### 5.1 新建动态
用于模拟角色在朋友圈（或类似社交平台）发布动态。
**格式:** [app:微信, type:新动态, data:JSON对象]
**`data` JSON对象内部字段:**
{
  "动态id": "moment_unique_id",
  "发布者id": "发动态人的手机号",
  "发布者昵称": "发动态人的昵称",
  "time": "HH:mm",
  "内容": "动态的文字内容。",
  "图片": ["image1.jpg"],
  "地点": "海边咖啡馆",
  "点赞": ["点赞人1的手机号"],
  "评论": [{"commenterId": "评论人1手机号", "text": "评论内容。"}]
}
- **发布者昵称**: (必须) 发布者的昵称，用于在发布者是新角色时创建联系人条目。

### 5.2 更新动态 (点赞/评论) - 新增
用于让角色对**已经存在**的动态进行点赞或评论。

**格式:**
[app:微信, type:更新动态, data:JSON对象]
- **type**: (必须) 固定为“更新动态”。
- **data**: (必须) 一个包含更新信息的 **JSON对象**。

**`data` JSON对象内部字段:**
{
  "动态id": "要更新的动态的unique_id",
  "action": "like",
  "actor_id": "执行操作的角色的手机号"
}
或
{
  "动态id": "要更新的动态的unique_id",
  "action": "comment",
  "actor_id": "执行操作的角色的手机号",
  "content": "评论的具体内容"
}
- **动态id**: (必须) 目标动态的唯一ID。
- **action**: (必须) `like` (点赞) 或 `comment` (评论)。
- **actor_id**: (必须) 点赞或评论者的唯一ID（手机号）。
- **content**: (可选) 如果 `action` 是 `comment`，则此字段为评论内容。

**示例:**
[app:微信, type:更新动态, data:{"动态id":"player_moment_001", "action":"like", "actor_id":"13812345678"}]
[app:微信, type:更新动态, data:{"动态id":"player_moment_001", "action":"comment", "actor_id":"13910284576", "content":"拍得真好！"}]

---

## 六、 更新角色资料
此指令用于动态更新角色的个人主页信息，例如个性签名、朋友圈封面等。

**格式:**
[app:微信, type:更新资料, data:JSON对象]
- **type**: (必须) 固定为“更新资料”。
- **data**: (必须) 一个包含要更新资料的 **JSON对象**。
**`data` JSON对象内部字段:**
{
  "profile_id": "要更新资料的角色手机号",
  "bio": "新的个性签名",
  "cover_image": "封面图文件名.jpg"
}

---

## 七、 通用规则与最佳实践
- **叙事包裹数据**: 永远不要只扔出一个干巴巴的格式文本。用一两句故事描述来包裹它（例如“你收到了xx发来的消息...”），这会让体验更沉浸。
- **精确性**: 严格遵守新格式中的所有符号和结构：[] , :。确保键值对完整且正确分隔。对于JSON格式，要确保双引号的正确使用。
- **时间戳**: 请确保在你的回复中，同时也包含一个用于定义全局时间的独立标签 (例如 <WorldState>)，插件会自动读取并结合，生成完整的时间戳。
- **玩家消息处理**: 当系统给予类似 (系统提示：【微信】回复谢予淮：你好) 的信息时，这代表玩家已经在手机上发了消息。你的任务是只生成对方的回复，不要重复玩家的话。